<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Across the Blue, I Found You</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@200;300;400;500;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(to bottom, #fde4e4, #fff0f0);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .text-shadow-light {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        @keyframes pulse-once {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.95; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pulse-once {
            animation: pulse-once 1.5s ease-in-out;
        }
        .slideshow-image {
            width: 100%;
            height: auto;
            max-height: 80vh;
            object-fit: contain;
            transition: opacity 1s ease-in-out;
            border-radius: 1.5rem;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 1s ease-in-out;
        }
        .birthday-content {
            overflow: hidden;
        }
        
        .password-container {
            text-align: center;
            padding: 40px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 90%;
        }
        .password-container h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #d12e6d;
            margin-bottom: 20px;
        }
        .password-container input {
            width: 100%;
            padding: 12px;
            border: 2px solid #f9a8d4;
            border-radius: 10px;
            font-size: 1rem;
            text-align: center;
            outline: none;
            transition: border-color 0.3s;
        }
        .password-container input:focus {
            border-color: #d12e6d;
        }
        .password-container button {
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            background-color: #d12e6d;
            color: white;
            border-radius: 10px;
            transition: background-color 0.3s;
        }
        .password-container button:hover {
            background-color: #a72456;
        }
        .message-box {
            margin-top: 15px;
            color: #ef4444;
            font-weight: 500;
        }
        .hidden {
            display: none;
        }
        .faded-out {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .faded-in {
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body>

    <div id="password-page" class="password-container">
        <h2>  الباسورد يكتكوتي</h2>
        <input type="password" id="passwordInput" placeholder="">
        <button onclick="checkPassword()">افتح ي سمسم</button>
        <p id="message" class="message-box"></p>
    </div>

    <div id="website-content" class="hidden">

        <div id="cover-page" class="h-screen w-full relative overflow-hidden flex flex-col justify-center items-center text-center text-white p-8">
            <div class="absolute inset-0 z-0 bg-cover bg-center" style="background-image: url('https://images.pexels.com/photos/1001682/pexels-photo-1001682.jpeg')"></div>
            <div class="absolute inset-0 z-10 bg-black opacity-40"></div>
            
            <div class="z-20">
                <h1 class="text-5xl md:text-6xl font-bold leading-tight text-white text-shadow-light">
                    Across the Blue, I Found You
                </h1>
                <p class="mt-4 text-xl md:text-2xl text-gray-200 text-shadow-light">
                A story of a heart that found its way home
                </p>
            </div>

            <div class="absolute bottom-10 z-20">
                <button id="start-story-btn" class="bg-rose-500 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-rose-600 transform transition-all duration-300 animate-pulse">
                    Start
                </button>
            </div>
        </div>

        <div id="main-content" class="max-w-4xl mx-auto p-8 lg:p-12 hidden">

            <div id="chapter-container" class="space-y-16 md:space-y-24">

                <section id="chapter1" class="bg-white p-8 md:p-10 rounded-3xl shadow-xl">
                    <h2 class="text-3xl md:text-4xl font-bold text-rose-800 mb-6 border-b-2 border-rose-200 pb-2">
                        رسالة من الماضي
                    </h2>
                    <p class="text-lg leading-relaxed text-gray-700">
                        "قصتنا مبدأتش في المدرسة زي ما أي حد ممكن يتخيل. قصتنا بدأت لما مشيتي.<br><br>
                        وقتها مكنتش مدرك إني ببص على أهم شخص في حياتي. كنتي جزء من أيامي من غير ما أدرك قيمتك الحقيقية. ولما سافرتي الحياة مشيت بمسارها كل واحد فينا في طريق.<br><br>
                        المسافة مكنتش مجرد بعد المسافة كانت فرصة لقلبي إنه يفهم. كل يوم بيعدي كل مكالمة وكل كلمة كانت بتخليني أحس بحبك بجد وإنه بينمو في صمت.<br><br>
                        دلوقتي وبعد كل الوقت ده قلبي عرف إنه بيحبك بجد. وكل اللي أتمناه هو إني أعيش معاكي بداية مفيهاش رجوع بداية فيها حب حقيقي."
                    </p>
                    <div class="mt-8 text-center">
                        <button onclick="nextChapter('chapter1')" class="bg-rose-500 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-rose-600 transition-colors duration-300">
                             اللي بعده
                        </button>
                    </div>
                </section>

                <section id="chapter2" class="bg-white p-8 md:p-10 rounded-3xl shadow-xl hidden">
                    <h2 class="text-3xl md:text-4xl font-bold text-rose-800 mb-6 border-b-2 border-rose-200 pb-2">
                        السبع ساعات
                    </h2>
                    <p class="text-lg leading-relaxed text-gray-700">
                        "أنا عمري ما هنسى المكالمة دي. سبع ساعات، سبع ساعات متواصلة من الكلام والضحك. في البداية كنت خايف الكلام يخلص بس اللي اكتشفته إن طول الوقت ده كان كافيه إنه يخلينا نعرف بعض بجد.<br><br>
                        حسيت إن كل دقيقة بتعدي بتقربني منك أكتر وإن المسافة اللي بيننا بتختفي مع كل كلمة. السبع ساعات دول كانوا أكتر من مجرد مكالمة كانوا نقطة تحول في قصتنا لحظة اكتشفت فيها قد إيه انتي مهمة بالنسبالي.<br><br>
                        عرفت في اليوم ده إنك مش مجرد بنت انتي صديقة وأخت وكل حاجة حلوة في الدنيا. السبع ساعات دول علموني إن الحب الحقيقي مش بيحتاج مكان هو بيحتاج بس قلبين مستعدين يتكلموا ويسمعوا لبعض."
                    </p>
                    <div class="mt-8 text-center">
                        <button onclick="nextChapter('chapter2')" class="bg-rose-500 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-rose-600 transition-colors duration-300">
                             اللي بعده
                        </button>
                    </div>
                </section>

                <section id="chapter3" class="bg-white p-8 md:p-10 rounded-3xl shadow-xl hidden">
                    <h2 class="text-3xl md:text-4xl font-bold text-rose-800 mb-6 border-b-2 border-rose-200 pb-2">
                        ليه بحبك
                    </h2>
                    <p class="text-lg leading-relaxed text-gray-700">
                        أحيانا بيكون الحب في اللحظات البسيطة. زي اللحظة اللي بتنور فيها الدنيا كلها لما بشوف ملامحك أو لما بسمع ضحكتك كل حاجة حواليا بتبقى أجمل. بس الحب الحقيقي بيكون في حاجات أعمق.<br><br>
                        أنا بحبك عشان قلبك الطيب اللي بيهتم بيا وبيخاف عليا. بحبك عشان دمك الخفيف اللي بيقدر ينسيني أي حاجة مضيقاني. وبحبك أكتر عشان الأمل اللي بتديهولي، إيمانك بيا بيخليني أشوف نفسي بطريقة أحسن.<br><br>
                        باختصار انتي كل حاجة في حياتي. حرفيا كل حاجة. انتي الأمان اللي بدور عليه أنتي البداية والنهاية. انتي السبب اللي خلاني أعرف إيه هو الحب بجد.
                    </p>
                    <div class="mt-8 text-center">
                        <button onclick="nextChapter('chapter3')" class="bg-rose-500 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-rose-600 transition-colors duration-300">
                             اللي بعده
                        </button>
                    </div>
                </section>

                <section id="chapter4" class="bg-white p-8 md:p-10 rounded-3xl shadow-xl hidden">
                    <h2 class="text-3xl md:text-4xl font-bold text-rose-800 mb-6 border-b-2 border-rose-200 pb-2">
                        بداية قصة لا تنتهي
                    </h2>
                    <p class="text-lg leading-relaxed text-gray-700">
                        "طريقنا كان طويل والمسافة اللي بيننا كانت أكبر تحدي. بس كل يوم بيعدي كل مكالمة وكل كلمة بتخليني متأكد إن نهاية الطريق ده هي انتي.<br><br>
                        أتمنى اليوم اللي تكون المسافة دي مجرد ذكرى. اليوم اللي أقدر أحتفل بعيد ميلادك وأنا ماسك إيدك اليوم اللي أقدر أشوف ضحكتك من غير شاشة. أنا بحلم باليوم اللي نمشي فيه في الشارع وأنا مش خايف إن اليوم يخلص.<br><br>
                        انتي اللي خلتيني أؤمن إن النهاية السعيدة مش مجرد خيال لكنها واقع ممكن نعيشه سوا. وده مش مجرد وعد ده وعد مني إني هعمل كل حاجة عشان نعيش كل أحلامنا مع بعض.
                        بحبك يكتكوتي."
                    </p>
                    <div class="mt-8 text-center">
                        <button onclick="nextChapter('chapter4')" class="bg-rose-500 text-white text-lg font-semibold py-4 px-10 rounded-full shadow-lg hover:bg-rose-600 transform transition-all duration-300 animate-pulse-once">
                            اضغطي هنا يا قمر
                        </button>
                    </div>
                </section>
            </div>
        </div>

        <div id="birthday-page" class="h-screen w-full hidden flex flex-col justify-center items-center text-center p-8 relative birthday-content">
            <canvas id="c"></canvas>
            
            <a href="https://open.spotify.com/track/6a4l9CrvajT9qtcFAY9oxk?si=f07b7400319749ce" target="_blank" class="absolute bottom-12 left-1/2 transform -translate-x-1/2 z-50">
    <button class="flex items-center space-x-2 px-6 py-3 bg-[#1DB954] text-white font-bold rounded-full shadow-2xl transition-all duration-300 hover:scale-105 animate-pulse">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 fill-white" viewBox="0 0 496 512"><path d="M24.7 97.4C36.9 83.9 55.4 78.4 73.8 84.4c5.1 1.7 10.1 3.9 14.9 6.7L190.2 165c30.9 16.4 69.9 16.4 100.8 0l101.4-58.4c5-2.8 10-5 15.1-6.7c18.4-6.1 36.9-.5 49.1 12.9s14.8 32.5 6 48.8l-12.7 22c-8.5 14.7-25.9 21.8-42.5 18.2l-5.6-1.2C364.7 200.5 352 184.2 352 166.4V64c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 7.4L240 148.2 198.7 103.5c-9.2-9.6-22.9-11.4-34.9-7.4S144 51.1 144 64v84.9c0 1.9-.3 3.8-.8 5.6l-2.6 9.3c-2.3 8.3-9.5 14.2-18 15.6l-5.5 .9c-16.6 2.8-32.9-4.8-43.1-18.1L23.4 146.2c-8.9-14.7-8-33.4 2-48.8zM240 288l43.2 24.9c5 2.8 10 5 15.1 6.7c18.4 6.1 36.9 .5 49.1-12.9s14.8-32.5 6-48.8l-12.7-22c-8.5-14.7-25.9-21.8-42.5-18.2l-5.6 1.2c-12.3 2.6-25-13.7-25-31.5V148.9l-4.7 2.6c-9.2 5.1-19.1 8.5-29.4 10.1-5.1 .8-10.2 1.2-15.3 1.2s-10.2-.4-15.3-1.2c-10.3-1.6-20.2-5-29.4-10.1l-4.7-2.6v31.5c0 1.9-.3 3.8-.8 5.6l-2.6 9.3c-2.3 8.3-9.5 14.2-18 15.6l-5.5 .9c-16.6 2.8-32.9-4.8-43.1-18.1L23.4 242.2C14.5 227.5 15.4 208.8 25.7 193.4s24.4-18.7 39-16.1l40.1 6.9c14.2 2.4 27.2 9.5 37 20l32.3 34.3c3.2 3.4 7.2 6.1 11.5 8.1l-.1 .1c13.7 6.4 28.3 9.6 42.9 9.6c.1 0 .2 0 .3 0zM240 352l-43.2 24.9c-5 2.8-10 5-15.1 6.7c-18.4 6.1-36.9 .5-49.1-12.9s-14.8-32.5-6-48.8l12.7-22c8.5-14.7 25.9-21.8 42.5-18.2l5.6 1.2c12.3 2.6 25-13.7 25-31.5v-10.6l32.3 18.6c9.2 5.3 19.1 8.8 29.4 10.3 5.1 .8 10.2 1.2 15.3 1.2s10.2-.4 15.3-1.2c10.3-1.6 20.2-5 29.4-10.1l4.7-2.6V336.9c0 1.9-.3 3.8-.8 5.6l-2.6 9.3c-2.3 8.3-9.5 14.2-18 15.6l-5.5 .9c-16.6 2.8-32.9-4.8-43.1-18.1L240 352zM455 336.1c1.5-.7 3.1-1.3 4.8-1.7l-4.8 1.7zM492.2 230c-2.8-5-5.9-9.8-9.3-14.4l12.7 22c-.6 1.2-1.3 2.4-2 3.5s-1.5 2.1-2.3 3.1c-1.2 1.4-2.5 2.8-3.9 4.1s-2.8 2.5-4.4 3.7c-5.7 4.5-12.1 7.6-18.9 9.2l-2.5 .6c-16.6 2.8-32.9-4.8-43.1-18.1L352 288l43.2-24.9c5-2.8 10-5 15.1-6.7c1.3-.4 2.6-.9 3.9-1.5 1.4-.6 2.7-1.3 4.1-2.1c1.6-.9 3.1-1.9 4.6-3.1s3-2.3 4.3-3.7l12.7-22c8.9-14.7 8-33.4-2-48.8s-24.4-18.7-39-16.1l-40.1 6.9c-14.2 2.4-27.2 9.5-37 20l-32.3 34.3c-13.7 6.4-28.3 9.6-42.9 9.6c-.1 0-.2 0-.3 0s-.2 0-.3 0c-14.7 0-29.3-3.2-42.9-9.6L127.3 268l-32.3-34.3c-9.8-10.5-22.8-17.6-37-20l-40.1-6.9c-14.7-2.5-28.1 4.7-37 19.4s-8 33.3 2 48.8l12.7 22c10.2 13.3 26.5 20.9 43.1 18.1l5.5-.9c16.6-2.8 32.9 4.8 43.1 18.1L240 352l-43.2-24.9c-5-2.8-10-5-15.1-6.7c-18.4-6.1-36.9-.5-49.1 12.9s-14.8 32.5-6 48.8l12.7 22c8.5 14.7 25.9 21.8 42.5 18.2l5.6-1.2c12.3-2.6 25 13.7 25 31.5V448c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-7.4L256 363.8l41.3 44.7c9.2 9.6 22.9 11.4 34.9 7.4s19.8-16.7 19.8-29.6V352l43.2-24.9c5-2.8 10-5 15.1-6.7c1.3-.4 2.6-.9 3.9-1.5c1.4-.6 2.7-1.3 4.1-2.1c1.6-.9 3.1-1.9 4.6-3.1s3-2.3 4.3-3.7l12.7-22c8.9-14.7 8-33.4-2-48.8s-24.4-18.7-39-16.1l-40.1 6.9c-14.2 2.4-27.2 9.5-37 20L352 336l-4.7 2.6c-9.2 5.1-19.1 8.5-29.4 10.1c-5.1 .8-10.2 1.2-15.3 1.2s-10.2-.4-15.3-1.2c-10.3-1.6-20.2-5-29.4-10.1l-4.7-2.6v31.5c0 1.9-.3 3.8-.8 5.6l-2.6 9.3c-2.3 8.3-9.5 14.2-18 15.6l-5.5 .9c-16.6 2.8-32.9-4.8-43.1-18.1L24.7 414.6c-8.9-14.7-8-33.4 2-48.8s24.4-18.7 39-16.1l40.1 6.9c14.2 2.4 27.2 9.5 37 20l32.3 34.3c13.7 6.4 28.3 9.6 42.9 9.6c.1 0 .2 0 .3 0s.2 0 .3 0c14.7 0 29.3-3.2 42.9-9.6L368 396.9V336.9c0-1.9 .3-3.8 .8-5.6l2.6-9.3c2.3-8.3 9.5-14.2 18-15.6l5.5-.9c16.6-2.8 32.9 4.8 43.1 18.1L492.2 312c8.9 14.7 8 33.4-2 48.8s-24.4 18.7-39 16.1l-40.1-6.9c-14.2-2.4-27.2-9.5-37-20L336 352z"/></svg>
        <span class="text-xl">اسمعي الأغنية</span>
    </button>
</a>
        </div>
    </div>

    <script>
        function checkPassword() {
            const password = document.getElementById("passwordInput").value;
            const correctPassword = "2001";
            const passwordPage = document.getElementById("password-page");
            const websiteContent = document.getElementById("website-content");
            const message = document.getElementById("message");

            if (password === correctPassword) {
                passwordPage.classList.add("hidden");
                websiteContent.classList.remove("hidden");
                document.body.style.display = 'block';
                document.body.style.justifyContent = 'initial';
                document.body.style.alignItems = 'initial';
                document.body.style.minHeight = 'initial';
            } else {
                message.textContent = " غلط يكتكوتي";
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const coverPage = document.getElementById('cover-page');
            const mainContent = document.getElementById('main-content');
            const startBtn = document.getElementById('start-story-btn');
            const birthdayPage = document.getElementById('birthday-page');

            // Map of chapters and their order
            const chapters = ['chapter1', 'chapter2', 'chapter3', 'chapter4'];

            function fadeOut(element, onComplete) {
                element.classList.add('faded-out');
                setTimeout(() => {
                    element.classList.add('hidden');
                    element.classList.remove('faded-out');
                    if (onComplete) onComplete();
                }, 500); // Match transition duration
            }

            function fadeIn(element) {
                element.classList.remove('hidden');
                setTimeout(() => {
                    element.classList.add('faded-in');
                }, 10); // Small delay to trigger transition
                setTimeout(() => {
                    element.classList.remove('faded-in');
                }, 510);
            }

            // Function to handle moving to the next chapter
            window.nextChapter = function(currentChapterId) {
                const currentIndex = chapters.indexOf(currentChapterId);
                const currentChapter = document.getElementById(currentChapterId);

                if (currentIndex < chapters.length - 1) {
                    const nextChapterId = chapters[currentIndex + 1];
                    const nextChapter = document.getElementById(nextChapterId);
                    
                    fadeOut(currentChapter, () => {
                        fadeIn(nextChapter);
                    });
                } else {
                    // This is the last chapter, so move to the birthday page
                    fadeOut(mainContent, () => {
                        fadeIn(birthdayPage);
                    });
                }
            };

            startBtn.addEventListener('click', () => {
                fadeOut(coverPage, () => {
                    fadeIn(mainContent);
                    const firstChapter = document.getElementById(chapters[0]);
                    fadeIn(firstChapter);
                });
            });

            let w = (c.width = window.innerWidth),
                h = (c.height = window.innerHeight),
                ctx = c.getContext("2d"),
                hw = w / 2;
            (hh = h / 2),
                (opts = {
                    strings: ["HAPPY", "BIRTHDAY!", "to You"],
                    charSize: 30,
                    charSpacing: 35,
                    lineHeight: 40,
                    cx: w / 2,
                    cy: h / 2,
                    fireworkPrevPoints: 10,
                    fireworkBaseLineWidth: 5,
                    fireworkAddedLineWidth: 8,
                    fireworkSpawnTime: 200,
                    fireworkBaseReachTime: 30,
                    fireworkAddedReachTime: 30,
                    fireworkCircleBaseSize: 20,
                    fireworkCircleAddedSize: 10,
                    fireworkCircleBaseTime: 30,
                    fireworkCircleAddedTime: 30,
                    fireworkCircleFadeBaseTime: 10,
                    fireworkCircleFadeAddedTime: 5,
                    fireworkBaseShards: 5,
                    fireworkAddedShards: 5,
                    fireworkShardPrevPoints: 3,
                    fireworkShardBaseVel: 4,
                    fireworkShardAddedVel: 2,
                    fireworkShardBaseSize: 3,
                    fireworkShardAddedSize: 3,
                    gravity: 0.1,
                    upFlow: -0.1,
                    letterContemplatingWaitTime: 360,
                    balloonSpawnTime: 20,
                    balloonBaseInflateTime: 10,
                    balloonAddedInflateTime: 10,
                    balloonBaseSize: 20,
                    balloonAddedSize: 20,
                    balloonBaseVel: 0.4,
                    balloonAddedVel: 0.4,
                    balloonBaseRadian: -(Math.PI / 2 - 0.5),
                    balloonAddedRadian: -1,
                }),
                (calc = {
                    totalWidth:
                        opts.charSpacing *
                        Math.max(opts.strings[0].length, opts.strings[1].length),
                }),
                (Tau = Math.PI * 2),
                (TauQuarter = Tau / 4),
                (letters = []);

            ctx.font = opts.charSize + "px Verdana";

            function Letter(char, x, y) {
                this.char = char;
                this.x = x;
                this.y = y;
                this.dx = -ctx.measureText(char).width / 2;
                this.dy = +opts.charSize / 2;
                this.fireworkDy = this.y - hh;
                var hue = (x / calc.totalWidth) * 360;
                this.color = "hsl(hue,80%,50%)".replace("hue", hue);
                this.lightAlphaColor = "hsla(hue,80%,light%,alp)".replace("hue", hue);
                this.lightColor = "hsl(hue,80%,light%)".replace("hue", hue);
                this.alphaColor = "hsla(hue,80%,50%,alp)".replace("hue", hue);
                this.reset();
            }
            Letter.prototype.reset = function () {
                this.phase = "firework";
                this.tick = 0;
                this.spawned = false;
                this.spawningTime = (opts.fireworkSpawnTime * Math.random()) | 0;
                this.reachTime =
                    (opts.fireworkBaseReachTime + opts.fireworkAddedReachTime * Math.random()) |
                    0;
                this.lineWidth =
                    opts.fireworkBaseLineWidth + opts.fireworkAddedLineWidth * Math.random();
                this.prevPoints = [[0, hh, 0]];
            };
            Letter.prototype.step = function () {
                if (this.phase === "firework") {
                    if (!this.spawned) {
                        ++this.tick;
                        if (this.tick >= this.spawningTime) {
                            this.tick = 0;
                            this.spawned = true;
                        }
                    } else {
                        ++this.tick;
                        var linearProportion = this.tick / this.reachTime,
                            armonicProportion = Math.sin(linearProportion * TauQuarter),
                            x = linearProportion * this.x,
                            y = hh + armonicProportion * this.fireworkDy;
                        if (this.prevPoints.length > opts.fireworkPrevPoints)
                            this.prevPoints.shift();
                        this.prevPoints.push([x, y, linearProportion * this.lineWidth]);
                        var lineWidthProportion = 1 / (this.prevPoints.length - 1);
                        for (var i = 1; i < this.prevPoints.length; ++i) {
                            var point = this.prevPoints[i],
                                point2 = this.prevPoints[i - 1];
                            ctx.strokeStyle = this.alphaColor.replace(
                                "alp",
                                i / this.prevPoints.length
                            );
                            ctx.lineWidth = point[2] * lineWidthProportion * i;
                            ctx.beginPath();
                            ctx.moveTo(point[0], point[1]);
                            ctx.lineTo(point2[0], point2[1]);
                            ctx.stroke();
                        }
                        if (this.tick >= this.reachTime) {
                            this.phase = "contemplate";
                            this.circleFinalSize =
                                opts.fireworkCircleBaseSize +
                                opts.fireworkCircleAddedSize * Math.random();
                            this.circleCompleteTime =
                                (opts.fireworkCircleBaseTime +
                                    opts.fireworkCircleAddedTime * Math.random()) |
                                0;
                            this.circleCreating = true;
                            this.circleFading = false;
                            this.circleFadeTime =
                                (opts.fireworkCircleFadeBaseTime +
                                    opts.fireworkCircleFadeAddedTime * Math.random()) |
                                0;
                            this.tick = 0;
                            this.tick2 = 0;
                            this.shards = [];
                            var shardCount =
                                (opts.fireworkBaseShards +
                                    opts.fireworkAddedShards * Math.random()) |
                                0,
                                angle = Tau / shardCount,
                                cos = Math.cos(angle),
                                sin = Math.sin(angle),
                                x = 1,
                                y = 0;
                            for (var i = 0; i < shardCount; ++i) {
                                var x1 = x;
                                x = x * cos - y * sin;
                                y = y * cos + x1 * sin;
                                this.shards.push(new Shard(this.x, this.y, x, y, this.alphaColor));
                            }
                        }
                    }
                } else if (this.phase === "contemplate") {
                    ++this.tick;
                    if (this.circleCreating) {
                        ++this.tick2;
                        var proportion = this.tick2 / this.circleCompleteTime,
                            armonic = -Math.cos(proportion * Math.PI) / 2 + 0.5;
                        ctx.beginPath();
                        ctx.fillStyle = this.lightAlphaColor
                            .replace("light", 50 + 50 * proportion)
                            .replace("alp", proportion);
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, armonic * this.circleFinalSize, 0, Tau);
                        ctx.fill();
                        if (this.tick2 > this.circleCompleteTime) {
                            this.tick2 = 0;
                            this.circleCreating = false;
                            this.circleFading = true;
                        }
                    } else if (this.circleFading) {
                        ctx.fillStyle = this.lightColor.replace("light", 70);
                        ctx.fillText(this.char, this.x + this.dx, this.y + this.dy);
                        ++this.tick2;
                        var proportion = this.tick2 / this.circleFadeTime,
                            armonic = -Math.cos(proportion * Math.PI) / 2 + 0.5;
                        ctx.beginPath();
                        ctx.fillStyle = this.lightAlphaColor
                            .replace("light", 100)
                            .replace("alp", 1 - armonic);
                        ctx.arc(this.x, this.y, this.circleFinalSize, 0, Tau);
                        ctx.fill();
                        if (this.tick2 >= this.circleFadeTime) this.circleFading = false;
                    } else {
                        ctx.fillStyle = this.lightColor.replace("light", 70);
                        ctx.fillText(this.char, this.x + this.dx, this.y + this.dy);
                    }
                    for (var i = 0; i < this.shards.length; ++i) {
                        this.shards[i].step();
                        if (!this.shards[i].alive) {
                            this.shards.splice(i, 1);
                            --i;
                        }
                    }
                    if (this.tick > opts.letterContemplatingWaitTime) {
                        this.phase = "balloon";
                        this.tick = 0;
                        this.spawning = true;
                        this.spawnTime = (opts.balloonSpawnTime * Math.random()) | 0;
                        this.inflating = false;
                        this.inflateTime =
                            (opts.balloonBaseInflateTime +
                                opts.balloonAddedInflateTime * Math.random()) |
                            0;
                        this.size =
                            (opts.balloonBaseSize + opts.balloonAddedSize * Math.random()) | 0;
                        var rad =
                            opts.balloonBaseRadian + opts.balloonAddedRadian * Math.random(),
                            vel = opts.balloonBaseVel + opts.balloonAddedVel * Math.random();
                        this.vx = Math.cos(rad) * vel;
                        this.vy = Math.sin(rad) * vel;
                    }
                } else if (this.phase === "balloon") {
                    ctx.strokeStyle = this.lightColor.replace("light", 80);
                    if (this.spawning) {
                        ++this.tick;
                        ctx.fillStyle = this.lightColor.replace("light", 70);
                        ctx.fillText(this.char, this.x + this.dx, this.y + this.dy);
                        if (this.tick >= this.spawnTime) {
                            this.tick = 0;
                            this.spawning = false;
                            this.inflating = true;
                        }
                    } else if (this.inflating) {
                        ++this.tick;
                        var proportion = this.tick / this.inflateTime,
                            x = (this.cx = this.x),
                            y = (this.cy = this.y - this.size * proportion);
                        ctx.fillStyle = this.alphaColor.replace("alp", proportion);
                        ctx.beginPath();
                        generateBalloonPath(x, y, this.size * proportion);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(x, this.y);
                        ctx.stroke();
                        ctx.fillStyle = this.lightColor.replace("light", 70);
                        ctx.fillText(this.char, this.x + this.dx, this.cy + this.dy + this.size);
                        if (this.tick >= this.inflateTime) {
                            this.tick = 0;
                            this.inflating = false;
                        }
                    } else {
                        this.cx += this.vx;
                        this.cy += this.vy += opts.upFlow;
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        generateBalloonPath(this.cx, this.cy, this.size);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.moveTo(this.cx, this.cy);
                        ctx.lineTo(this.cx, this.cy + this.size);
                        ctx.stroke();
                        ctx.fillStyle = this.lightColor.replace("light", 70);
                        ctx.fillText(this.char, this.cx + this.dx, this.cy + this.dy + this.size);
                        if (this.cy + this.size < -hh || this.cx < -hw || this.cy > hw)
                            this.phase = "done";
                    }
                }
            };
            function Shard(x, y, vx, vy, color) {
                var vel =
                    opts.fireworkShardBaseVel + opts.fireworkShardAddedVel * Math.random();
                this.vx = vx * vel;
                this.vy = vy * vel;
                this.x = x;
                this.y = y;
                this.prevPoints = [[x, y]];
                this.color = color;
                this.alive = true;
                this.size =
                    opts.fireworkShardBaseSize + opts.fireworkShardAddedSize * Math.random();
            }
            Shard.prototype.step = function () {
                this.x += this.vx;
                this.y += this.vy += opts.gravity;
                if (this.prevPoints.length > opts.fireworkShardPrevPoints)
                    this.prevPoints.shift();
                this.prevPoints.push([this.x, this.y]);
                var lineWidthProportion = this.size / this.prevPoints.length;
                for (var k = 0; k < this.prevPoints.length - 1; ++k) {
                    var point = this.prevPoints[k],
                        point2 = this.prevPoints[k + 1];
                    ctx.strokeStyle = this.color.replace("alp", k / this.prevPoints.length);
                    ctx.lineWidth = k * lineWidthProportion;
                    ctx.beginPath();
                    ctx.moveTo(point[0], point[1]);
                    ctx.lineTo(point2[0], point2[1]);
                    ctx.stroke();
                }
                if (this.prevPoints[0][1] > hh) this.alive = false;
            };
            function generateBalloonPath(x, y, size) {
                ctx.moveTo(x, y);
                ctx.bezierCurveTo(
                    x - size / 2,
                    y - size / 2,
                    x - size / 4,
                    y - size,
                    x,
                    y - size
                );
                ctx.bezierCurveTo(x + size / 4, y - size, x + size / 2, y - size / 2, x, y);
            }
            function anim() {
                window.requestAnimationFrame(anim);
                ctx.fillStyle = "#111";
                ctx.fillRect(0, 0, w, h);
                ctx.translate(hw, hh);
                var done = true;
                for (var l = 0; l < letters.length; ++l) {
                    letters[l].step();
                    if (letters[l].phase !== "done") done = false;
                }
                ctx.translate(-hw, -hh);
                if (done) for (var l = 0; l < letters.length; ++l) letters[l].reset();
            }
            for (let i = 0; i < opts.strings.length; ++i) {
                for (var j = 0; j < opts.strings[i].length; ++j) {
                    letters.push(
                        new Letter(
                            opts.strings[i][j],
                            j * opts.charSpacing +
                            opts.charSpacing / 2 -
                            (opts.strings[i].length * opts.charSize) / 2,
                            i * opts.lineHeight +
                            opts.lineHeight / 2 -
                            (opts.strings.length * opts.lineHeight) / 2
                        )
                    );
                }
            }
            anim();
            window.addEventListener("resize", function () {
                w = c.width = window.innerWidth;
                h = c.height = window.innerHeight;
                hw = w / 2;
                hh = h / 2;
                ctx.font = opts.charSize + "px Verdana";
            });
        });
    </script>
</body>
</html>